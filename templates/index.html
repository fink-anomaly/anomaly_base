<!DOCTYPE HTML>
<html>
	<head>
		<title>Anomaly base</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="{{ url_for('static', path='/assets/css/main.css') }}"/>
		<noscript><link rel="stylesheet" href="{{ url_for('static', path='/assets/css/noscript.css') }}"/></noscript>
		<style>
		table {
		  width: 100%;
		  border-collapse: collapse;
		}
		th, td {
		  border: 1px solid black;
		  padding: 8px;
		  text-align: left;
		}
	  </style>
	</head>
	<body class="is-preload">

		<!-- Wrapper-->
			<div id="wrapper">

				<!-- Nav -->
					<nav id="nav">
						<a href="#" class="icon solid fa-home"><span>Home</span></a>
						{% if user %}
							<a href="#work" class="icon solid fa-folder"><span>Anomalies</span></a>
						{% endif %}
					</nav>

				<!-- Main -->
					<div id="main">
							<article id="home" class="panel intro">

									
									{% if user %}
										<header>
											<h1>Hello!</h1>
											<p>{{user.name}}</p>
										</header>
										<a href="#work" class="jumplink pic">
											<span class="arrow icon solid fa-chevron-right"><span>Data</span></span>
										</a>
									{% else %}
										<header>
											<h1>Auth</h1>
										</header>
										{% for error in errors %}
											<p style="color: red">{{ error }}</p>
										{% endfor %}
										<form action="/auth/login" method="post">
											<div class="col-6 col-12-medium">
												<input type="text" name="username" placeholder="username" value="{{ username }}" required>
											</div>
											<p> </p>
											<div class="col-12">
												<input type="password" name="password" placeholder="password" value="{{ password }}" required>
											</div>
											<input type="submit" value="Login">
										</form>	
									{% endif %}
							</article>

							<article id="work" class="panel">
								{% if user %}
									<header>
										<h2>Your anomalies üïµÔ∏è</h2>
									</header>
									<p>Hello {{ user.name }}! You have {{count}} reactions now</p>
									<table class="dataframe">
									  <thead>
										<tr style="text-align: right;">
										  <th>ztf_id</th>
										  <th>tag</th>
										  <th>user</th>
										  <th>changed_at</th>
											<th></th>
										</tr>
									  </thead>
									  <tbody>

										{% for row in table %}
											<tr>
												<td><a href=https://fink-portal.org/{{row.ztf_id}}>{{row.ztf_id}}</a></td>
												<td>{{row.tag}}</td>
												<td>{{row.user}}</td>
												<td>{{row.changed_at}}</td>
												<td>        <button id="{{row.id}}">Delete</button>
											<script>
												const token_ = 'Bearer ' + '{{token}}';
												document.getElementById("{{row.id}}").addEventListener("click", async function() {
													const response = await fetch('/reaction/{{row.id}}', {
														method: 'DELETE',
														headers: {
															'Authorization': token_,
															'Content-Type': 'application/json'
														}
													});
													if (response.ok) {
														location.reload();
													}
												});
											</script></td>
											</tr>
										{% endfor %}
									  </tbody>
									</table>
								{% endif %}
							</article>


					</div>

				<!-- Footer -->
					<div id="footer">
						<ul class="copyright">
							<li>Anomaly base.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="{{ url_for('static', path='/assets/js/jquery.min.js') }}"></script>
			<script src="{{ url_for('static', path='/assets/js/browser.min.js') }}"></script>
			<script src="{{ url_for('static', path='/assets/js/breakpoints.min.js') }}"></script>
			<script src="{{ url_for('static', path='/assets/js/util.js') }}"></script>
			<script src="{{ url_for('static', path='/assets/js/main.js') }}"></script>

	</body>
</html>